$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")
});
$PBJQ(function(){var f=$PBJQ("#toolMenu");
var d=$PBJQ("#content");
if(d.length==1){var e=f.height();
if($PBJQ(document.body).height()<$PBJQ(window).height()){var b=$PBJQ("#footer").outerHeight();
var a=d.offset().top;
var c=$PBJQ(window).height()-a-b;
e=Math.max(e,c)
}d.css("minHeight",e+"px")
}});
$PBJQ("details").details();
$PBJQ(document).ready(function(){updateFooterTime=(function(){if($PBJQ("#preferredTime").length==1){var c=$PBJQ("#preferredTime").data("preferredtzdisplay");
var e=new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset")));
var a=e.getTime()-(new Date()).getTime()
}var b=$PBJQ("#serverTime").data("servertzdisplay");
var d=new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset")));
var f=d.getTime()-(new Date()).getTime();
return function(){var g=new Date((new Date()).getTime()+f);
var h=g.toUTCString().replace(/GMT/,b).replace(/UTC/,b);
$PBJQ("#serverTime").text(h);
if($PBJQ("#preferredTime").length==1){var g=new Date((new Date()).getTime()+a);
var h=g.toUTCString().replace(/GMT/,c).replace(/UTC/,c);
$PBJQ("#preferredTime").text(h)
}setTimeout("updateFooterTime()",1000)
}
})();
if($PBJQ("#serverTime").length==1){updateFooterTime()
}});
var dhtml_view_sites=function(){$PBJQ("#selectSiteModal").addClass("dhtml_more_tabs");
$PBJQ(".more-tab").position();
var a=$PBJQ(window).height()*0.8;
dhtml_view_sites=function(){var e=$PBJQ("#selectSiteModal");
e.show();
if(e.hasClass("outscreen")){$PBJQ("body").toggleClass("active-more-sites");
var b=$PBJQ(".view-all-sites-btn:visible");
var d=b.height()+5;
if(b.length>0){b.css("z-index",1005);
var c=b.offset().top-$(window).scrollTop()+d;
var f=$PBJQ("body").outerWidth()-(b.offset().left+b.outerWidth());
if($PBJQ("html").attr("dir")!=="rtl"){e.css("top",c).css("right",f)
}else{e.css("top",c).css("left",$PBJQ("body").outerWidth()-f)
}}e.toggleClass("outscreen");
a-=c;
a-=parseInt(e.css("padding-bottom"),20);
if(MorpheusViewportHelper.isNonPhone()){$PBJQ("#txtSearch").focus()
}createDHTMLMask(dhtml_view_sites);
$PBJQ(".selectedTab").bind("click",function(g){dhtml_view_sites();
return false
});
$PBJQ(".tab-pane:first").focus();
$PBJQ(document).trigger("view-sites-shown")
}else{$PBJQ("body").toggleClass("active-more-sites");
$PBJQ("#selectSiteModal").toggleClass("outscreen");
var b=$PBJQ(".view-all-sites-btn");
b.css("z-index","auto");
$PBJQ("#selectSite").attr("tabindex","-1");
removeDHTMLMask();
$PBJQ("#otherSiteTools").remove();
$PBJQ(".selectedTab").unbind("click")
}};
if($(window).width()<800){a=a*0.85
}$PBJQ(".tab-pane").css("height",a);
dhtml_view_sites()
};
function closeDrawer(){$PBJQ("#selectSiteModal").toggleClass("outscreen");
removeDHTMLMask();
$PBJQ("#selectSite").attr("tabindex","-1");
$PBJQ("#otherSiteTools").remove();
$PBJQ(".selectedTab").unbind("click");
$PBJQ(".moreSitesLink").unbind("keydown");
$PBJQ(".more-tab a").focus()
}function createDHTMLMask(a){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>');
$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1000,top:0,left:0}).bind("click",function(b){a();
return false
});
$PBJQ("#portalMask").bgiframe()
}function removeDHTMLMask(){$PBJQ("#portalMask").remove()
}function showToolMenu(h){var g=h.attr("id");
var a=g.replace(/!/g,"\\!").replace(/~/g,"\\~");
$PBJQ(".toolMenus").removeClass("toolMenusActive");
if($PBJQ("."+a).length){$PBJQ("#otherSiteTools").remove()
}else{var c=$PBJQ('<ul id="otherSiteTools" role="menu" />').addClass(g);
var f="/direct/site/"+g+"/pages.json";
scroll(0,0);
var e=parseInt($PBJQ("#maxToolsInt").text());
var d=$PBJQ("#maxToolsText").text();
var i=$PBJQ('<li class="otherSiteTool" ><span><a role="menuitem"><span class="Mrphs-toolsNav__menuitem--icon"> </span></a></span></li>');
var b=i.clone();
b.addClass("gotosite");
b.find("a").attr("href",portal.portalPath+"/site/"+g).attr("title",d).append(d);
b.find("a span").addClass("icon-sakai--see-all-tools");
$PBJQ.getJSON(f,function(j){$PBJQ.each(j,function(l,m){if(!m.tools[0]){return true
}if(l<e){var k=i.clone();
k.find("a").attr("href",m.tools[0].url).attr("title",m.title).append(m.title);
k.find("a span").addClass("icon-sakai--"+m.tools[0].toolId.replace(/\./gi,"-")).addClass("otherSiteToolIcon");
if(m.toolpopup){k.find("a").attr("href",m.tools[0].url+"?sakai.popup=yes").attr("onclick","window.open("+m.toolpopupurl+"); return false")
}c.append(k)
}});
if(j.length>e){c.append(b.clone())
}$PBJQ("#otherSiteTools").remove();
h.closest("li").append(c);
h.parent().find(".toolMenus").addClass("toolMenusActive")
})
}}$PBJQ(document).ready(function(){if($PBJQ("#eid").length===1){$PBJQ("#eid").focus()
}$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",dhtml_view_sites);
$PBJQ("#show-all-sites, .view-all-sites-btn").on("click",dhtml_view_sites);
var b=portal.siteTitle;
if(b){if(portal.shortDescription){b=b+" ("+portal.shortDescription+")"
}$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+b+":</span> ")
}$PBJQ("#txtSearch").keyup(function(d){if(d.keyCode==27){a()
}if($PBJQ("#txtSearch").val().length>0){var e=$PBJQ("#txtSearch").val().toLowerCase();
$PBJQ(".fav-sites-term, .fav-sites-entry").hide();
var c=$PBJQ(".fav-sites-entry").filter(function(f,g){return($PBJQ(".fav-title a span.fullTitle",g).text().toLowerCase().indexOf(e)>=0)
});
c.show();
c.closest(".fav-sites-term").show()
}if($PBJQ("#txtSearch").val().length==0){a()
}if($PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1){$PBJQ(".norecords").remove();
$PBJQ("#noSearchResults").fadeIn("slow")
}});
function a(){$PBJQ("#txtSearch").val("");
$PBJQ(".fav-sites-term, .fav-sites-entry").show();
$PBJQ("#noSearchResults").hide();
$PBJQ("#txtSearch").focus()
}$PBJQ("#otherSiteSearchClear").on("click",function(){a()
});
$PBJQ("#presenceToggle").click(function(c){c.preventDefault();
$PBJQ("#presenceArea").toggle()
});
$PBJQ(".trayPopupClose").click(function(c){c.preventDefault();
$PBJQ(this).closest(".trayPopup").hide()
});
if($PBJQ("a.tool-directurl").length){$PBJQ("a.tool-directurl").cluetip({local:true,arrows:true,cluetipClass:"jtip",sticky:true,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'})
}});
$PBJQ(document).ready(function(e){var n=true;
var v=undefined;
var z=[];
var g=$PBJQ("#max-favorite-entries").text().trim();
var x=false;
var l=$PBJQ("#selectSite");
var r=$PBJQ("#otherSitesCategorWrap");
var m=$PBJQ("#organizeFavorites");
var o={};
$PBJQ(".site-favorite-btn",r).each(function(A,B){o[$PBJQ(B).data("site-id")]=$PBJQ(B).parent()
});
var b={favorite:{markup:'<i class="site-favorite-icon site-favorite"></i>'},nonfavorite:{markup:'<i class="site-favorite-icon site-nonfavorite"></i>'},myworkspace:{markup:'<i class="site-favorite-icon site-workspace site-favorite"></i>'}};
var d=function(A){$PBJQ.ajax({url:"/portal/favorites/list",method:"GET",dataType:"json",success:function(B){n=B.autoFavoritesEnabled;
z=B.favoriteSiteIds.filter(function(D,C){return D!=""
});
if(v==undefined){v=z
}A(z)
}})
};
var p=function(A,C){var B=b[C];
$PBJQ(A).data("favorite-state",C);
if(C==="favorite"){$PBJQ(A).attr("title",$PBJQ("#removeFromFavoritesText").text())
}else{if(C==="nonfavorite"){$PBJQ(A).attr("title",$PBJQ("#addToFavoritesText").text())
}else{$PBJQ(A).attr("title",null)
}}$PBJQ(A).empty().append($PBJQ(B.markup))
};
var f=function(){var A=$PBJQ(".fav-sites-entry .site-favorite",r).length;
$PBJQ(".favoriteCount",l).text("("+A+")");
if(A>g){$PBJQ(".favoriteCountAndWarning").addClass("maxFavoritesReached")
}else{$PBJQ(".favoriteCountAndWarning").removeClass("maxFavoritesReached")
}};
var i=function(){$PBJQ(".favorites-select-all-none",r).each(function(A,C){var E=e(C).closest(".fav-sites-term");
var B=E.find(".fav-sites-entry:not(.my-workspace)").length;
var D=E.find(".fav-sites-entry .site-favorite").length;
if(B==0){e(C).hide()
}else{if(D==B){e(C).data("favorite-state","favorite");
e(C).html(b.favorite.markup)
}else{e(C).data("favorite-state","nonfavorite");
e(C).html(b.nonfavorite.markup)
}e(C).show()
}})
};
var s=function(){$PBJQ(".site-favorite-btn",r).empty();
$PBJQ(".favorites-select-all-none",r).empty()
};
var k=function(A){$PBJQ(".site-favorite-btn",r).each(function(B,C){var D=$PBJQ(C).data("site-id");
if($PBJQ(C).closest(".my-workspace").length>0){p(C,"myworkspace")
}else{if($PBJQ.inArray(D,A)>=0){p(C,"favorite")
}else{p(C,"nonfavorite")
}}});
e(".favorites-help-text").hide();
if(n){e(".favorites-help-text.autofavorite-enabled").show()
}else{e(".favorites-help-text.autofavorite-disabled").show()
}i();
f();
x=true
};
var w=function(){return $PBJQ(".site-favorite-btn",r).has(".site-favorite").map(function(){return $PBJQ(this).data("site-id")
}).toArray()
};
var h=function(A){if(q){x=false;
s()
}if(!A){A=0
}if(q&&A<100){setTimeout(function(){h(A+1)
},50)
}else{d(k)
}};
var y=function(B,A){if(B.length!=A.length){return false
}for(var C=0;
C<B.length;
C++){if(B[C]!=A[C]){return false
}}return true
};
var j=function(){if(y(z,v)){$PBJQ(".moresites-refresh-notification").remove();
return
}if($PBJQ(".moresites-refresh-notification").length>0){return
}var A=$PBJQ('<div class="moresites-refresh-notification" />').html($PBJQ("#refreshNotificationText").html());
$PBJQ("#loginLinks").prepend(A);
A.css("top",($PBJQ(".Mrphs-siteHierarchy").offset().top)+"px")
};
var q=false;
var u=[];
var t=function(A){var B;
while(u.length>0){B=u.shift()
}if(B){$PBJQ.ajax({url:"/portal/favorites/update",method:"POST",data:{userFavorites:JSON.stringify(B),},error:A,complete:t})
}else{q=false
}};
var a=function(B){if(!x){return
}if(!B){B=function(){}
}var A=w();
A=A.sort(function(E,D){if(z.indexOf(E)===-1){return 1
}else{if(z.indexOf(D)===-1){return -1
}else{return z.indexOf(E)-z.indexOf(D)
}}});
var C={favoriteSiteIds:A,autoFavoritesEnabled:n,};
u.push(C);
if(q){}else{q=true;
t(B)
}z=A;
j()
};
var c=function(E){if(v&&v.includes(E)){var A=v.indexOf(E);
var C=false;
for(var F=A-1;
F>=0;
F--){var D=v[F];
var B=z.indexOf(D);
if(B>=0&&B<A){z.splice(B+1,0,E);
C=true;
break
}}if(!C){z.splice(A,0,E)
}}};
$PBJQ(r).on("click",".site-favorite-btn",function(){var B=this;
var D=$PBJQ(B).data("site-id");
var A=$PBJQ(B).data("favorite-state");
if(A==="myworkspace"){return
}var C;
if(A==="favorite"){C="nonfavorite"
}else{C="favorite"
}if(C=="favorite"){c(D)
}p(B,C);
i();
f();
a(function(){h()
})
});
$PBJQ(r).on("click",".favorites-select-all-none",function(){var B=e(this).data("favorite-state");
var A=e(this).closest(".fav-sites-term").find(".fav-sites-entry:not(.my-workspace) .site-favorite-btn");
var C;
if(B=="favorite"){C="nonfavorite"
}else{C="favorite"
}A.each(function(D,E){p(e(E),C)
});
f();
i();
a(function(){h()
})
});
$PBJQ(l).on("click",".tab-btn",function(){$PBJQ(".tab-btn",l).removeClass("active");
$PBJQ(this).addClass("active");
var A=$PBJQ(this).data("tab-target");
$PBJQ(".tab-box").hide();
$PBJQ(l).trigger("tab-shown",A);
$PBJQ("#"+A).show()
});
$PBJQ(document).on("view-sites-shown",function(){h()
});
$PBJQ(l).on("tab-shown",function(D,A){if(A==="organizeFavorites"){var C=$PBJQ("#organizeFavoritesList");
C.empty();
e("#noFavoritesToShow").hide();
e("#favoritesToShow").hide();
$PBJQ("#otherSiteTools").remove();
$PBJQ("#organizeFavoritesPurgatoryList").empty();
$PBJQ.each(z,function(F,H){if(!o[H]){return
}if($PBJQ(o[H]).hasClass("my-workspace")){return
}var G=o[H].clone(false);
G.addClass("organize-favorite-item").data("site-id",H);
var E=$PBJQ('<a href="javascript:void(0);" class="fav-drag-handle"><i class="fa fa-bars"></i></a>');
$PBJQ(".toolMenus",G).remove();
G.append(E);
C.append(G);
G.show()
});
if(C.find("li").length==0){e("#noFavoritesToShow").show()
}else{e("#favoritesToShow").show()
}var B=function(){var E=e(".organize-favorite-item");
E.removeClass("site-favorite-is-past-max");
$PBJQ(".favorites-max-marker").remove();
$PBJQ.each(E,function(G,F){if(G>=g){e(F).addClass("site-favorite-is-past-max")
}if(G==g){e(F).before($PBJQ('<li class="favorites-max-marker"><i class="fa fa-warning warning-icon"></i> '+e("#maxFavoritesLimitReachedText").text()+"</li>"))
}})
};
B();
C.sortable({items:"li:not(.favorites-max-marker)",handle:".fav-drag-handle",stop:function(){B();
z=C.find(".organize-favorite-item").map(function(){return $PBJQ(this).data("site-id")
}).toArray();
a()
}});
C.disableSelection();
e("#autoFavoritesEnabled").prop("checked",n);
e("#organizeFavorites .onoffswitch").show()
}});
$PBJQ(r).on("click",".toolMenus",function(A){A.preventDefault();
showToolMenu($PBJQ(this));
return false
});
$PBJQ(m).on("click",".site-favorite-btn",function(){var C=this;
if($PBJQ(C).closest(".my-workspace").length>0){return
}var A=$PBJQ(C).parent();
var B;
if($PBJQ(C).closest("#organizeFavoritesList").length==0){var E=$PBJQ(C).data("site-id");
c(E);
var D=z.indexOf(E);
if(D==0){$PBJQ("#organizeFavoritesList").prepend(A)
}else{if(D>0){$PBJQ("#organizeFavoritesList li:nth-child("+D+")").after(A)
}else{$PBJQ("#organizeFavoritesList").append(A)
}}B="favorite"
}else{$PBJQ("#organizeFavoritesPurgatoryList").append(A);
B="nonfavorite"
}p(C,B);
p(o[$PBJQ(C).data("site-id")].find(".site-favorite-btn"),B);
i();
f();
a(function(){h()
})
});
$PBJQ("#autoFavoritesEnabled").on("change",function(){n=this.checked;
e(".favorites-help-text").hide();
if(this.checked){e(".favorites-help-text.autofavorite-enabled").show()
}else{e(".favorites-help-text.autofavorite-disabled").show()
}a();
return true
});
$PBJQ(".otherSitesMenuClose").on("click",function(){dhtml_view_sites()
})
});
var profile=profile||{};
profile.requestFriend=function(b,a){$PBJQ.ajax({url:"/direct/profile/"+b+"/requestFriend?friendId="+a,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-unconnected-block-"+a).hide();
$PBJQ("#profile-popup-requested-block-"+a).show()
});
return false
};
profile.confirmFriendRequest=function(b,a){$PBJQ.ajax({url:"/direct/profile/"+b+"/confirmFriendRequest?friendId="+a,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-accept-block-"+a).hide();
$PBJQ("#profile-popup-ignore-block-"+a).hide();
$PBJQ("#profile-popup-connected-block-"+a).show()
});
return false
};
profile.removeFriend=function(a,b){$PBJQ.ajax({url:"/direct/profile/"+a+"/removeFriend?friendId="+b,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-connected-block-"+b).hide();
$PBJQ("#profile-popup-unconnected-block-"+b).show()
});
return false
};
profile.ignoreFriendRequest=function(a,b){$PBJQ.ajax({url:"/direct/profile/"+a+"/ignoreFriendRequest?friendId="+b,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-requested-block-"+b).hide();
$PBJQ("#profile-popup-ignore-block-"+b).hide();
$PBJQ("#profile-popup-accept-block-"+b).hide();
$PBJQ("#profile-popup-unconnected-block-"+b).show()
});
return false
};
function publishSite(b){var a="/direct/site/"+b+"/edit";
var c=$PBJQ.ajax({type:"POST",data:"published=true",url:a,success:function(){location.reload()
}}).responseText
}function quickLinksNavEscHandler(a){if(a.keyCode===27){toggleQuickLinksNav(a)
}}function toggleQuickLinksNav(b){b.preventDefault();
if(!$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")){toggleUserNav(b)
}$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden");
if(!$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden")){var a=$PBJQ('<div class="quicklinks-dropdown-overlay" />');
a.on("click",function(c){toggleQuickLinksNav(c)
});
$PBJQ("body").prepend(a);
$PBJQ(document).on("keyup",quickLinksNavEscHandler)
}else{$PBJQ(".quicklinks-dropdown-overlay").remove();
$PBJQ(document).off("keyup",quickLinksNavEscHandler)
}}$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav);
$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav);
function toggleToolsNav(a){if(a){a.preventDefault()
}$PBJQ("body").toggleClass("toolsNav--displayed");
if($PBJQ("body").hasClass("toolsNav--displayed")){createDHTMLMask(toggleToolsNav)
}else{removeDHTMLMask()
}}$PBJQ(document).ready(function(){function a(){function b(){if($PBJQ("#roleSwitchDropDown").is(".open")){$PBJQ("#roleSwitchDropDownToggle").trigger("click")
}}function c(d){if(d.keyCode==27){b();
return false
}return true
}$PBJQ("#roleSwitchDropDownToggle").attr("aria-hidden","false");
$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true").attr("aria-label","submenu");
$PBJQ("#roleSwitchDropDownToggle").click(function(){$PBJQ("#roleSwitchDropDown").css("right",$(window).width()-20-($("#roleSwitchDropDownToggle").offset().left+$("#roleSwitchDropDownToggle").width()));
$PBJQ("#roleSwitchDropDown").toggleClass("open");
if($PBJQ("#roleSwitchDropDown").is(".open")){$PBJQ("#roleSwitchDropDown").attr("aria-hidden","false");
$PBJQ(document.body).prepend('<div class="user-dropdown-overlay"></div>');
$PBJQ(".user-dropdown-overlay").on("click",function(){b()
});
$PBJQ(document.body).on("keyup",c);
setTimeout(function(){$PBJQ("#roleSwitchDropDown").find("a, :input").focus()
})
}else{$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true");
$PBJQ(".user-dropdown-overlay").remove();
$PBJQ(document.body).off("keyup",c);
$PBJQ("#roleSwitchDropDownToggle").focus()
}})
}$PBJQ("#roleSwitchSelect").on("change",function(){if($PBJQ("option:selected",this).text()!==""){document.location=$PBJQ("option:selected",this).val()
}else{$PBJQ(this)[0].selectedIndex=0
}});
if(MorpheusViewportHelper.isPhone()){a()
}else{$PBJQ("#roleSwitch").addClass("menu-not-setup")
}});
$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);
var sessionId="current";
var sessionTimeOut;
var timeoutDialogEnabled=false;
var timeoutDialogWarningTime;
var timeoutLoggedoutUrl;
var timeoutPortalPath;
$PBJQ(document).ready(function(){if(portal.loggedIn&&portal.timeoutDialog){setTimeout("setup_timeout_config();",60000)
}});
var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled;
timeoutDialogWarningTime=portal.timeoutDialog.seconds;
timeoutLoggedoutUrl=portal.loggedOutUrl;
timeoutPortalPath=portal.portalPath;
if(timeoutDialogEnabled==true){poll_session_data();
fetch_timeout_dialog()
}};
var poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date()).getTime(),dataType:"json",success:function(b){b.maxInactiveInterval=b.maxInactiveInterval*1000;
if(b.active&&b.userId!=null&&b.lastAccessedTime+b.maxInactiveInterval>b.currentTime){var a=b.lastAccessedTime+b.maxInactiveInterval-b.currentTime;
if(a<timeoutDialogWarningTime*1000){min=Math.round(a/(1000*60));
show_timeout_alert(min);
clearTimeout(sessionTimeOut);
sessionTimeOut=setTimeout("poll_session_data()",1000*60)
}else{clearTimeout(sessionTimeOut);
sessionTimeOut=setTimeout("poll_session_data()",(a-timeoutDialogWarningTime*1000))
}}else{if(b.userId==null){location.href=timeoutLoggedoutUrl
}else{sessionTimeOut=setTimeout("poll_session_data()",1000*10)
}}},error:function(c,a,b){}})
};
function keep_session_alive(){dismiss_session_alert();
$PBJQ.get(timeoutPortalPath)
}var dismiss_session_alert=function(){removeDHTMLMask();
$PBJQ("#timeout_alert_body").remove()
};
var timeoutDialogFragment;
function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:true,dataType:"text",success:function(a){timeoutDialogFragment=a
},error:function(c,a,b){timeoutDialogEnabled=false
}})
}function show_timeout_alert(b){if(!timeoutDialogEnabled){return
}if(!$PBJQ("#portalMask").get(0)){createDHTMLMask(dismiss_session_alert);
$PBJQ("#portalMask").css("z-index",1000)
}if($PBJQ("#timeout_alert_body").get(0)){$PBJQ("#timeout_alert_body span").html(b)
}else{var a=timeoutDialogFragment.replace("{0}",b);
$PBJQ("body").append(a)
}}function toggleShortUrlOutput(b,c,a){if($PBJQ(c).is(":checked")){$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(b),dataType:"text",success:function(d){$PBJQ("."+a).val(d)
}})
}else{$PBJQ("."+a).val(b)
}}$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(b){var a=$PBJQ(this).position();
$PBJQ(this).siblings(".Mrphs-directUrl").toggleClass("active").css({left:a.left+"px"});
b.preventDefault()
});
$PBJQ(".Mrphs-directUrl .dropDown_close").click(function(a){$PBJQ(this).parent().toggleClass("active");
a.preventDefault()
})
});
var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var a=$PBJQ(this).attr("href");
$PBJQ(a).attr("tabindex","-1").focus()
})
};
$PBJQ(document).ready(function(){var a=0;
$PBJQ(document).scroll(function(c){var b=$PBJQ(this).scrollTop();
if(b>a&&b>90){$PBJQ(".Mrphs-topHeader").addClass("moving");
$PBJQ(".Mrphs-siteHierarchy").addClass("moving");
$PBJQ(".Mrphs-toolsNav__title--current-site").addClass("moving");
$PBJQ(".Mrphs-skipNav__menu").addClass("moving");
$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").addClass("moving")
}else{if(b>90||b==0){$PBJQ(".Mrphs-topHeader").removeClass("moving");
$PBJQ(".Mrphs-siteHierarchy").removeClass("moving");
$PBJQ(".Mrphs-toolsNav__title--current-site").removeClass("moving");
$PBJQ(".Mrphs-skipNav__menu").removeClass("moving");
$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").removeClass("moving")
}}a=b
})
});
var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible");
$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible");
$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked");
$PBJQ(".sitenav-dropdown-overlay").remove()
};
var buildDropdownMenu=function(b,a,g){var i='<ul class="Mrphs-sitesNav__submenu" role="menu">';
var e=parseInt($PBJQ("#linkNav").attr("data-max-tools-int"));
var d=$PBJQ("#linkNav").attr("data-max-tools-anchor");
var c='<li class="Mrphs-sitesNav__submenuitem Mrphs-sitesNav__submenuitem__gotosite"><a role="menuitem" href="'+portal.portalPath+"/site/"+a+'" title="'+d+'"><span class="toolMenuIcon icon-sakai--see-all-tools"></span>'+d+"</a></li>";
var f="/direct/site/"+a+"/pages.json";
var h=window.location.pathname.split("/").pop();
$PBJQ.ajax({url:f,dataType:"json",success:function(j){$PBJQ.each(j,function(n,o){if(!o.tools||o.tools.length<=0){return
}var m="";
if(h==o.tools[0].id){m=" is-current"
}if(n<=e){var l;
if(o.toolpopup){var k=' role="menuitem" href="{{tool_url}}?sakai.popup=yes" title="{{item_title}}" onclick="window.open(\'{{item_toolpopupurl}}\');"';
l='<li class="Mrphs-sitesNav__submenuitem" ><a class="Mrphs-sitesNav__submenuitem-link"'+k+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>'
}else{var k=' role="menuitem" href="{{tool_url}}" title="{{item_title}}"';
l='<li class="Mrphs-sitesNav__submenuitem{{is_current}}"><a class="Mrphs-sitesNav__submenuitem-link"'+k+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>'
}i+=(l.replace(/{{tool_url}}/g,o.tools[0].url).replace(/{{item_title}}/g,o.title).replace(/{{item_toolpopupurl}}/g,o.toolpopupurl).replace(/{{icon}}/g,o.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,m))
}});
if((j.length-1)>e){i+=c
}i+="</ul>";
i=$PBJQ(i);
b.append(i);
addArrowNavAndDisableTabNav(i);
g(i)
},error:function(l,j,k){}})
};
var setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){if(a.keyCode==27){closeAllDropdownMenus()
}})
});
$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",function(a){if(a.keyCode==40){a.preventDefault();
var b=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown");
if(b.data("clicked")){}else{b.data("clicked",true);
b.trigger("click",[true])
}}else{if(a.keyCode==27){a.preventDefault();
closeAllDropdownMenus()
}}});
$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(f,b){f.preventDefault();
var h=$PBJQ(f.target);
var a=h.parent(".Mrphs-sitesNav__menuitem");
var g=a.hasClass("dropdown-is-visible");
closeAllDropdownMenus();
if(g){return
}var d=$PBJQ(this);
var c=function(i){d.addClass("is-clicked");
a.addClass("dropdown-is-visible");
i.addClass("is-visible");
if(b){a.find("a.Mrphs-sitesNav__submenuitem-title").first().focus()
}var e=$PBJQ('<div class="sitenav-dropdown-overlay" />');
e.on("click",function(j){closeAllDropdownMenus()
});
$PBJQ("body").prepend(e);
d.removeData("clicked")
};
if(!a.find("ul").length){buildDropdownMenu(a,h.attr("data-site-id"),c)
}else{c(a.find("ul"))
}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")
})
};
function addArrowNavAndDisableTabNav(a){a.find("li a").attr("tabindex","-1").keydown(function(f){var d=$PBJQ(f.target);
if(f.keyCode==40){f.preventDefault();
var b=d.closest("li").next();
if(b.length===0||b.find("a.Mrphs-sitesNav__submenuitem-title").length==0){b=a.find("li").first()
}b.find("a.Mrphs-sitesNav__submenuitem-title").focus()
}else{if(f.keyCode==38){f.preventDefault();
var c=d.closest("li").prev();
if(c.length===0){c=a.find("a.Mrphs-sitesNav__submenuitem-title").closest("ul")
}c.find("a.Mrphs-sitesNav__submenuitem-title").focus()
}else{if(f.keyCode==9){closeAllDropdownMenus()
}}}})
}function toggleMinimizeNav(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed");
$PBJQ("#subSites.floating").css({display:"none"});
var b=$PBJQ(this);
var a=$PBJQ(".accessibility-btn-label",b);
b.toggleClass("min max");
if(a.text()==b.data("title-expand")||collapsed){document.cookie="sakai_nav_minimized=false; path=/";
collapsed=false;
a.text(b.data("text-original"));
b.attr("title",(b.data("text-original")));
b.attr("aria-pressed",true)
}else{document.cookie="sakai_nav_minimized=true; path=/";
collapsed=true;
b.data("text-original",a.text());
a.text(b.data("title-expand"));
b.attr("title",(b.data("title-expand")));
b.attr("aria-pressed",false)
}}$PBJQ(".js-toggle-nav").on("click",toggleMinimizeNav);
var collapsed=false;
$PBJQ(document).ready(function(){if(getCookieVal("sakai_nav_minimized")==="true"){$PBJQ(".js-toggle-nav").click();
collapsed=true
}});
function getCookieVal(d){var c=document.cookie.split(";");
for(var b=0;
b<c.length;
++b){var a=(c[b].substring(0,c[b].indexOf("="))).trim();
if(a===d){return((c[b].split("="))[1]).trim()
}}return undefined
}jQuery(function(){var b=$(".Mrphs-collapseTools");
if(b.length>0){var a=function(){var c=$("#toolMenuWrap").outerWidth();
b.css("position","fixed").css("bottom",0).css("left",0).css("display","flex").css("width",c);
b.addClass("floatingToolMenu")
};
a();
b.on("click",a)
}});
function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:false,success:function(g){var f=g.indexOf("<ul");
if(f<1){$PBJQ("#presenceCount").html(" ");
$PBJQ("#presenceCount").removeClass("present").addClass("empty");
location.reload();
return
}g=g.substr(f);
var e=g;
var b="<li";
var a=0;
for(var d=0;
d<e.length;
d++){if(b==e.substr(d,b.length)){a++
}}if(a>1){$PBJQ("#presenceCount").html(a+"");
$PBJQ("#presenceCount").removeClass("empty").addClass("present")
}else{if(a==1){$PBJQ("#presenceCount").html(a+"");
$PBJQ("#presenceCount").removeClass("present").addClass("empty")
}else{$PBJQ("#presenceCount").html(" ");
$PBJQ("#presenceCount").removeClass("present").addClass("empty")
}}$PBJQ("#presenceIframe").html(g);
var c=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");
$PBJQ("#presenceIframe .presenceList li.inChat span").wrap('<a href="'+c+'"></a>');
sakaiLastPresenceTimeOut=setTimeout("updatePresence()",30000)
},error:function(b,a){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",60000)
}})
}function userNavEscHandler(a){if(a.keyCode===27){toggleUserNav(a)
}}function toggleUserNav(b){b.preventDefault();
$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden");
if(!$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")){var a=$PBJQ('<div class="user-dropdown-overlay" />');
a.on("click",function(c){toggleUserNav(c)
});
$PBJQ("body").prepend(a);
$PBJQ(document).on("keyup",userNavEscHandler)
}else{$PBJQ(".user-dropdown-overlay").remove();
$PBJQ(document).off("keyup",userNavEscHandler)
}}$PBJQ("#loginLink1").click(function(a){if($PBJQ(this).attr("data-warning")!==""&&!confirm($PBJQ(this).attr("data-warning"))){a.preventDefault()
}});
$PBJQ(".js-toggle-user-nav a#loginUser > .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);
$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);
$PBJQ(".Mrphs-userNav__pic-changer").on("click",function(b){var k=$PBJQ(this);
if(!window.FileReader){$PBJQ(k.data("profileLink")).trigger("click");
return true
}if(!$PBJQ.fn.modal){$PBJQ(k.data("profileLink")).trigger("click");
return true
}b.preventDefault();
b.stopImmediatePropagation();
function i(){l.find(".modal-body .alert").hide();
$PBJQ.ajax("/direct/profile-image/remove",{data:{sakai_csrf_token:sakai_csrf_token},type:"POST",dataType:"json",success:function(q,r,p){if(q.status=="SUCCESS"){g();
$("#cropToolbar").hide()
}else{$PBJQ("#remove-error").show()
}}})
}function d(){a.find("> img").cropper({aspectRatio:1/1,checkCrossOrigin:false,guides:true,minContainerWidth:300,minContainerHeight:300,autoCropArea:1,viewMode:1,dragMode:"move"})
}function e(){var p=$("#cropToolbar").show();
if(!portal.pictureToolbarSetup){$(".profile-image-zoom-in",p).on("click",function(){a.find("> img").cropper("zoom",0.1)
});
$(".profile-image-zoom-out",p).on("click",function(){a.find("> img").cropper("zoom",-0.1)
});
$(".profile-image-pan-up",p).on("click",function(){a.find("> img").cropper("move",0,-10)
});
$(".profile-image-pan-down",p).on("click",function(){a.find("> img").cropper("move",0,10)
});
$(".profile-image-pan-left",p).on("click",function(){a.find("> img").cropper("move",10,0)
});
$(".profile-image-pan-right",p).on("click",function(){a.find("> img").cropper("move",-10,0)
});
$(".profile-image-rotate",p).on("click",function(){a.find("> img").cropper("clear");
a.find("> img").cropper("rotate",90);
a.find("> img").cropper("crop")
});
portal.pictureToolbarSetup=true
}}function f(p){a.show();
a.find("> img").cropper("clear");
a.find("> img").cropper("replace",p);
j.removeProp("disabled");
e()
}function c(){$PBJQ.getJSON("/direct/profile-image/details?_="+new Date().getTime(),function(p){if(p.status=="SUCCESS"){if(!p.isDefault){f(p.url+"?_="+new Date().getTime());
$PBJQ(".remove-profile-image").on("click",function(){i()
})
}}sakai_csrf_token=p.csrf_token
})
}function n(){return new Promise(function(p){p(a.find("> img").cropper("getCroppedCanvas",{width:200,height:200}).toDataURL())
})
}function g(){var r=$PBJQ("#loginUser > .Mrphs-userNav__submenuitem--profilepicture");
var q=r.parent();
r.detach();
var s=new Date();
var p="background-image: url(/direct/profile/"+portal.user.id+"/image/thumb?"+s.getTime()+")";
r.attr("style",p);
q.prepend(r);
r=$PBJQ(".Mrphs-userNav__submenuitem--profilelink > .Mrphs-userNav__submenuitem--profilepicture");
q=r.parent();
r.detach();
r.attr("style",p);
q.prepend(r);
$("#profileImageUpload").modal("hide")
}function m(p){l.find(".modal-body .alert").hide();
$PBJQ.ajax("/direct/profile-image/upload",{data:{sakai_csrf_token:sakai_csrf_token,base64:p},type:"POST",dataType:"json",success:function(r,s,q){if(r.status=="SUCCESS"){g()
}else{$PBJQ("#upload-error").show()
}}})
}var l=$PBJQ("#profileImageUpload");
var o=false;
l.on("shown.bs.modal",function(){c()
});
l.modal({width:320});
$PBJQ("#remove-error").hide();
$PBJQ("#upload-error").hide();
var j=l.find("#save");
var h=$PBJQ("#file");
var a=$PBJQ("#cropme").hide();
d();
h.on("change",function(){var q=$PBJQ(this);
if(this.files&&this.files[0]){var p=new FileReader();
p.onload=function(r){f(r.target.result)
};
p.readAsDataURL(this.files[0])
}else{throw"Browser does not support FileReader"
}});
j.on("click",function(p){n().then(function(q){m(q.replace(/^data:image\/(png|jpg);base64,/,""))
})
});
return false
});
var header=$(".Mrphs-topHeader");
var currentHeaderWidth=-1;
$PBJQ(document).ready(function(){$(header).data("sticked",false);
if($PBJQ(".Mrphs-hierarchy--parent-sites").length>0&&$PBJQ(window).width()<=800){$PBJQ("#content").css("margin-top",(parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(true))+"px")
}$PBJQ(window).resize(function(){currentHeaderWidth=$(".Mrphs-mainHeader").width()
});
$PBJQ(window).scroll(function(){var b=0;
var a=(($(document).height()-$(window).height())>$(header).height())===true;
if($(window).scrollTop()>0){if($(header).data("sticked")===false&&a===true){$(header).data("sticked",true);
$(".Mrphs-mainHeader").addClass("is-fixed")
}}else{$(".Mrphs-mainHeader").removeClass("is-fixed");
$(header).data("sticked",false)
}});
currentHeaderWidth=$(".Mrphs-mainHeader").width();
$PBJQ(".Mrphs-headerLogo").on("click",function(){document.body.scrollTop=0;
document.body.scrollLeft=0;
$PBJQ(window).trigger("scroll")
})
});
function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)
}function f_filterResults(d,b,a){var c=d?d:0;
if(b&&(!c||(c>b))){c=b
}return a&&(!c||(c>a))?a:c
}$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){if($PBJQ(this).prop("disabled")){$PBJQ(this).parent("label").addClass("disabled")
}});
$PBJQ(document).keyup(function(a){if(a.keyCode==27){if(!$PBJQ("#selectSiteModal").hasClass("outscreen")){$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click")
}$PBJQ(".Mrphs-directUrl__dropDown").each(function(){if($PBJQ(this).hasClass("active")){$PBJQ(this).find(".dropDown_close").trigger("click")
}});
$PBJQ(".fip-icon-up-dir").trigger("click");
$PBJQ(".navigatePanelControls .close").trigger("click")
}})
});
var MorpheusViewportHelper={isPhone:function(){return $PBJQ("#Mrphs-viewport-helpers .phone").is(":visible")
},isTablet:function(){return $PBJQ("#Mrphs-viewport-helpers .tablet").is(":visible")
},isDesktop:function(){return $PBJQ("#Mrphs-viewport-helpers .desktop").is(":visible")
},isNonPhone:function(){return(this.isDesktop()||this.isTablet())&&!this.isPhone()
},};
$PBJQ(document).ready(function(){if($PBJQ("#loginLink2").length==1){$PBJQ("#loginLink2").click(function(a){$PBJQ("body").append('<div id="Mrphs-xlogin-container" />');
$PBJQ("#Mrphs-xlogin-container").load("/portal/xlogin #Mrphs-xlogin",function(){$PBJQ("#Mrphs-xlogin-container").addClass("loaded");
$PBJQ("#Mrphs-xlogin").addClass("loadedByAjax");
$PBJQ("#eid").focus()
});
$PBJQ(".Mrphs-portalWrapper").addClass("blurry");
$PBJQ("body").append('<div id="loginPortalMask" />');
$PBJQ("#loginPortalMask").bgiframe();
$PBJQ("#loginPortalMask").click(function(){$PBJQ("#loginPortalMask").remove();
$PBJQ("#Mrphs-xlogin-container").remove();
$PBJQ(".Mrphs-portalWrapper").removeClass("blurry")
});
a.preventDefault()
})
}});